<!DOCTYPE html>
<html lang="pt-PT" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>As minhas Consultas</title>
    <link rel="stylesheet" th:href="@{/styles.css}" />
    <link rel="stylesheet" th:href="@{/consultas.css}" />
  </head>
  <body>
    <div class="container">
      <h1>As minhas Consultas</h1>

      <table
        class="consulta-table"
        th:if="${consultas != null and !consultas.isEmpty()}"
      >
        <thead>
          <tr>
            <th>Data</th>
            <th>Hora</th>
            <th>Especialidade</th>
            <th>Médico</th>
            <th>Estado</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="consulta : ${consultas}">
            <td th:text="${#dates.format(consulta.data, 'dd/MM/yyyy')}">
              25/06/2025
            </td>
            <td th:text="${consulta.hora}">14:30</td>
            <td th:text="${consulta.especialidade}">Cardiologia</td>
            <td th:text="${consulta.medico.nome}">Dr. Silva</td>
            <td th:text="${consulta.status}">PENDENTE</td>
            <td>
              <a
                th:href="@{'/paciente/consultas/' + ${consulta.id}}"
                class="link"
                >Ver</a
              >
              <form
                th:if="${consulta.status.name() == 'PENDENTE'}"
                th:action="@{'/paciente/consultas/' + ${consulta.id} + '/cancelar'}"
                method="post"
                style="display: inline"
              >
                <button type="submit" class="danger small">Cancelar</button>
              </form>
            </td>
          </tr>
        </tbody>
      </table>

      <p th:if="${consultas == null or consultas.isEmpty()}" class="info-msg">
        Não existem consultas agendadas.
      </p>

      <a th:href="@{/}" class="link">← Voltar ao Início</a>
    </div>
  </body>
</html>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const formatarDataHora = (isoString) => {
        const data = new Date(isoString);
        if (isNaN(data.getTime())) return isoString;

        const dia = String(data.getDate()).padStart(2, '0');
        const mes = String(data.getMonth() + 1).padStart(2, '0');
        const ano = data.getFullYear();

        const horas = String(data.getHours()).padStart(2, '0');
        const minutos = String(data.getMinutes()).padStart(2, '0');

        return `${dia}/${mes}/${ano} ${horas}:${minutos}`;
    };

    const elementos = document.querySelectorAll('.data-hora');
    elementos.forEach(el => {
        const original = el.textContent.trim();
        el.textContent = formatarDataHora(original);
    });
});
</script>
